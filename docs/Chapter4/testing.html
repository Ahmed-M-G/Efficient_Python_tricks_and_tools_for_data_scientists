
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing &#8212; Effective Python for Data Scientists</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cool Tools" href="../Chapter5/Chapter5.html" />
    <link rel="prev" title="Better Pandas" href="better_pandas.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/data_simplified_icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Effective Python for Data Scientists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   Efficient Python Tricks and Tools for Data Scientists
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../how_to_read.html">
   How to Read This Book
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter1/Chapter1.html">
   Python Built-in Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/string.html">
     String
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/number.html">
     Number
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Chapter1/list/list.html">
     List
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/good_practices.html">
       Good Practices
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/get_elements.html">
       Get Elements
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/unpack_iterables.html">
       Unpack Iterables
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/join_iterable.html">
       Join Iterables
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/interaction_between_2_lists.html">
       Interaction Between 2 Lists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/apply_functions_to_elements.html">
       Apply Functions to Elements in a List
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/tuple.html">
     Tuple
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/dictionary.html">
     Dictionary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/function.html">
     Efficient Function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/class.html">
     Classes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/datetime.html">
     Datetime
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/best_practices.html">
     Best Practices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/code_speed.html">
     Code Speed
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/collections.html">
     Collections
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/itertools.html">
     Itertools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/functools.html">
     Functools
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter2/Chapter2.html">
   Pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/change_values.html">
     Change Values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/get_values.html">
     Get Values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/testing.html">
     Testing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter3/Chapter3.html">
   NumPy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/Numpy.html">
     NumPy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Chapter4.html">
   Data Science Tools
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="feature_extraction.html">
     Feature Extraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="get_data.html">
     Get Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="manage_data.html">
     Manage Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="machine_learning.html">
     Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="natural_language_processing.html">
     Natural Language Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sharing_downloading.html">
     Sharing and Downloading
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="speed_up_code.html">
     Tools to Speed Up Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="visualization.html">
     Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="best_python_practice_tools.html">
     Tools for Best Python Practices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="better_pandas.html">
     Better Pandas
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Testing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter5/Chapter5.html">
   Cool Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/alternative_approach.html">
     Alternative Approach
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/automation.html">
     Automation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/better_outputs.html">
     Better Outputs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/git_github.html">
     Git and GitHub
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter6/Chapter6.html">
   Jupyter Notebook
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter6/jupyter_notebook.html">
     Jupyter Notebook
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Chapter4/testing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/issues/new?title=Issue%20on%20page%20%2FChapter4/testing.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/master?urlpath=lab/tree/./Chapter4/testing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/blob/master/./Chapter4/testing.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#snoop-smart-print-to-debug-your-python-function">
   snoop : Smart Print to Debug Your Python Function
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-benchmark-a-pytest-fixture-to-benchmark-your-code">
   pytest benchmark: A Pytest Fixture to Benchmark Your Code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-mark-parametrize-test-your-functions-with-multiple-inputs">
   pytest.mark.parametrize: Test Your Functions with Multiple Inputs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-fixtures-use-the-same-data-for-different-tests">
   Pytest Fixtures: Use The Same Data for Different Tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-repeat">
   Pytest repeat
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pandera-a-python-library-to-validate-your-pandas-dataframe">
   Pandera: a Python Library to Validate Your Pandas DataFrame
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="snoop-smart-print-to-debug-your-python-function">
<h2>snoop : Smart Print to Debug Your Python Function<a class="headerlink" href="#snoop-smart-print-to-debug-your-python-function" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install snoop
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: snoop in /home/khuyen/book/venv/lib/python3.8/site-packages (0.4.0)
Requirement already satisfied: cheap-repr&gt;=0.4.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from snoop) (0.4.6)
Requirement already satisfied: executing in /home/khuyen/book/venv/lib/python3.8/site-packages (from snoop) (0.8.0)
Requirement already satisfied: six in /home/khuyen/book/venv/lib/python3.8/site-packages (from snoop) (1.16.0)
Requirement already satisfied: asttokens in /home/khuyen/book/venv/lib/python3.8/site-packages (from snoop) (2.0.5)
Requirement already satisfied: pygments in /home/khuyen/book/venv/lib/python3.8/site-packages (from snoop) (2.10.0)
</pre></div>
</div>
</div>
</div>
<p>If you want to figure out what is happening in your code without adding many print statements, try snoop.</p>
<p>To use snoop, simply add the <code class="docutils literal notranslate"><span class="pre">&#64;snoop</span></code> decorator to a function you want to understand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">snoop</span> 

<span class="nd">@snoop</span>
<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The factorial of </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">factorial</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20:11:29.45 &gt;&gt;&gt; Call to factorial in File &quot;/tmp/ipykernel_341813/20705592.py&quot;, line 4
20:11:29.45 ...... x = 2
20:11:29.45    4 | def factorial(x: int):
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20:11:29.45    5 |     if x == 1:
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20:11:29.46    8 |         return (x * factorial(x-1))
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    20:11:29.46 &gt;&gt;&gt; Call to factorial in File &quot;/tmp/ipykernel_341813/20705592.py&quot;, line 4
    20:11:29.46 ...... x = 1
    20:11:29.46    4 | def factorial(x: int):
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    20:11:29.46    5 |     if x == 1:
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    20:11:29.46    6 |         return 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    20:11:29.46 &lt;&lt;&lt; Return value from factorial: 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20:11:29.46    8 |         return (x * factorial(x-1))
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20:11:29.46 &lt;&lt;&lt; Return value from factorial: 2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The factorial of 2 is 2
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://towardsdatascience.com/3-tools-to-track-and-visualize-the-execution-of-your-python-code-666a153e435e">Link to my article about snoop</a>.</p>
</div>
<div class="section" id="pytest-benchmark-a-pytest-fixture-to-benchmark-your-code">
<h2>pytest benchmark: A Pytest Fixture to Benchmark Your Code<a class="headerlink" href="#pytest-benchmark-a-pytest-fixture-to-benchmark-your-code" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest-benchmark
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytest-benchmark in /home/khuyen/book/venv/lib/python3.8/site-packages (3.4.1)
Requirement already satisfied: py-cpuinfo in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest-benchmark) (8.0.0)
Requirement already satisfied: pytest&gt;=3.8 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest-benchmark) (6.2.5)
Requirement already satisfied: toml in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.8-&gt;pytest-benchmark) (0.10.2)
Requirement already satisfied: pluggy&lt;2.0,&gt;=0.12 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.8-&gt;pytest-benchmark) (0.13.1)
Requirement already satisfied: py&gt;=1.8.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.8-&gt;pytest-benchmark) (1.10.0)
Requirement already satisfied: packaging in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.8-&gt;pytest-benchmark) (21.0)
Requirement already satisfied: iniconfig in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.8-&gt;pytest-benchmark) (1.1.1)
Requirement already satisfied: attrs&gt;=19.2.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.8-&gt;pytest-benchmark) (21.2.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pyparsing&gt;=2.0.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from packaging-&gt;pytest&gt;=3.8-&gt;pytest-benchmark) (2.4.7)
</pre></div>
</div>
</div>
</div>
<p>If you want to benchmark your code while testing with pytest, try pytest-benchmark.</p>
<p>To understand how pytest-benchmark works, add the code below to the file named <code class="docutils literal notranslate"><span class="pre">pytest_benchmark_example.py</span></code>. Note that we add <code class="docutils literal notranslate"><span class="pre">benchmark</span></code> to the test function that we want to benchmark.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_benchmark_example.py</span>
<span class="k">def</span> <span class="nf">list_comprehension</span><span class="p">(</span><span class="n">len_list</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_list</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">test_concat</span><span class="p">(</span><span class="n">benchmark</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">list_comprehension</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>On your terminal, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest pytest_benchmark_example.py
</pre></div>
</div>
<p>Now you should see the statistics of the time it takes to excecute the test functions on your terminal:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pytest pytest_benchmark_example.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-0.13.1
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter4
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0
<span class=" -Color -Color-Bold">collecting ... </span>
<span class=" -Color -Color-Bold">collected 1 item                                                               </span>

pytest_benchmark_example.py 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">.                                            [100%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">---------------------------------------------------- benchmark: 1 tests ----------------------------------------------------</span>
Name (time in ns)          Min         Max      Mean   StdDev    Median     IQR   Outliers  OPS (Mops/s)  Rounds  Iterations
<span class=" -Color -Color-Yellow">----------------------------------------------------------------------------------------------------------------------------</span>
test_concat         <span class=" -Color -Color-Bold">  305.3494  5,237.7502  332.3408  71.6519  327.9500  8.7501</span>  1274;1681<span class=" -Color -Color-Bold">        3.0090</span>  147254          20
<span class=" -Color -Color-Yellow">----------------------------------------------------------------------------------------------------------------------------</span>

Legend:
  Outliers: 1 Standard Deviation from Mean; 1.5 IQR (InterQuartile Range) from 1st Quartile and 3rd Quartile.
  OPS: Operations Per Second, computed as 1 / Mean
<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 2.43s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/ionelmc/pytest-benchmark">Link to pytest-benchmark</a>.</p>
</div>
<div class="section" id="pytest-mark-parametrize-test-your-functions-with-multiple-inputs">
<h2>pytest.mark.parametrize: Test Your Functions with Multiple Inputs<a class="headerlink" href="#pytest-mark-parametrize-test-your-functions-with-multiple-inputs" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytest in /home/khuyen/book/venv/lib/python3.8/site-packages (6.2.5)
Requirement already satisfied: pluggy&lt;2.0,&gt;=0.12 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (0.13.1)
Requirement already satisfied: packaging in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (21.0)
Requirement already satisfied: attrs&gt;=19.2.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (21.2.0)
Requirement already satisfied: py&gt;=1.8.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (1.10.0)
Requirement already satisfied: toml in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (0.10.2)
Requirement already satisfied: iniconfig in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (1.1.1)
Requirement already satisfied: pyparsing&gt;=2.0.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from packaging-&gt;pytest) (2.4.7)
</pre></div>
</div>
</div>
</div>
<p>If you want to test your function with different examples, use <code class="docutils literal notranslate"><span class="pre">pytest.mark.parametrize</span></code> decorator.</p>
<p>To understand how <code class="docutils literal notranslate"><span class="pre">pytest.mark.parametrize</span></code> works, start with adding the code below to <code class="docutils literal notranslate"><span class="pre">pytest_parametrize.py</span></code>. <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> is added to the test function <code class="docutils literal notranslate"><span class="pre">test_text_contain_word</span></code> to tell pytest to experiment with different pairs of inputs and expected outputs specified in its arguments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_parametrize.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">def</span> <span class="nf">text_contain_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Find whether the text contains a particular word&#39;&#39;&#39;</span>
    
    <span class="k">return</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span>

<span class="n">test</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;There is a duck in this text&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;There is nothing here&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;sample, expected&#39;</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_text_contain_word</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>

    <span class="n">word</span> <span class="o">=</span> <span class="s1">&#39;duck&#39;</span>

    <span class="k">assert</span> <span class="n">text_contain_word</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
<p>In the code above, I expect the first sentence to contain the word “duck” and expect the second sentence not to contain that word. Let’s see if my expectations are correct by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest pytest_parametrize.py
</pre></div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pytest pytest_parametrize.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-0.13.1
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter4
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0
<span class=" -Color -Color-Bold">collecting ... </span>
<span class=" -Color -Color-Bold">collected 2 items                                                              </span>

pytest_parametrize.py 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">..                                                 [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">2 passed</span><span class=" -Color -Color-Green"> in 0.03s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>Sweet! 2 tests passed when running pytest.</p>
<p><a class="reference external" href="https://towardsdatascience.com/pytest-for-data-scientists-2990319e55e6?sk=2d3a81903b154db0c7ca832b9f29fee8">Link to my article about pytest</a>.</p>
</div>
<div class="section" id="pytest-fixtures-use-the-same-data-for-different-tests">
<h2>Pytest Fixtures: Use The Same Data for Different Tests<a class="headerlink" href="#pytest-fixtures-use-the-same-data-for-different-tests" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytest in /home/khuyen/book/venv/lib/python3.8/site-packages (6.2.5)
Requirement already satisfied: iniconfig in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (1.1.1)
Requirement already satisfied: packaging in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (21.0)
Requirement already satisfied: py&gt;=1.8.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (1.10.0)
Requirement already satisfied: pluggy&lt;2.0,&gt;=0.12 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (0.13.1)
Requirement already satisfied: attrs&gt;=19.2.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (21.2.0)
Requirement already satisfied: toml in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest) (0.10.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pyparsing&gt;=2.0.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from packaging-&gt;pytest) (2.4.7)
</pre></div>
</div>
</div>
</div>
<p>Sometimes, you might want to use the same data to test different functions. If you are using pytest, use pytest fixtures to provide data to different test functions instead.</p>
<p>To understand how to use pytest fixtures, start with adding the code below to the file named <code class="docutils literal notranslate"><span class="pre">pytest_fixture.py</span></code>. We use the decorator <code class="docutils literal notranslate"><span class="pre">&#64;pytest.fixture</span></code> to create the data we want to use many times.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_fixture.py</span>
<span class="kn">import</span> <span class="nn">pytest</span> 
<span class="kn">from</span> <span class="nn">textblob</span> <span class="kn">import</span> <span class="n">TextBlob</span>

<span class="k">def</span> <span class="nf">extract_sentiment</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract sentimetn using textblob. Polarity is within range [-1, 1]&quot;&quot;&quot;</span>
    
    <span class="n">text</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">sentiment</span><span class="o">.</span><span class="n">polarity</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span> 
<span class="k">def</span> <span class="nf">example_data</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Today I found a duck and I am happy&#39;</span>

<span class="k">def</span> <span class="nf">test_extract_sentiment</span><span class="p">(</span><span class="n">example_data</span><span class="p">):</span>
    <span class="n">sentiment</span> <span class="o">=</span> <span class="n">extract_sentiment</span><span class="p">(</span><span class="n">example_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">sentiment</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
<p>On your terminal, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest pytest_fixture.py
</pre></div>
</div>
<p>Output:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pytest pytest_fixture.py 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-0.13.1
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter4
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0
<span class=" -Color -Color-Bold">collecting ... </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">collecting 1 item                                                              </span>
<span class=" -Color -Color-Bold">collected 1 item                                                               </span>

pytest_fixture.py 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">.                                                      [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 0.63s ===============================</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pytest-repeat">
<h2>Pytest repeat<a class="headerlink" href="#pytest-repeat" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest-repeat
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytest-repeat in /home/khuyen/book/venv/lib/python3.8/site-packages (0.9.1)
Requirement already satisfied: pytest&gt;=3.6 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest-repeat) (6.2.5)
Requirement already satisfied: toml in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.6-&gt;pytest-repeat) (0.10.2)
Requirement already satisfied: attrs&gt;=19.2.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.6-&gt;pytest-repeat) (21.2.0)
Requirement already satisfied: py&gt;=1.8.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.6-&gt;pytest-repeat) (1.10.0)
Requirement already satisfied: pluggy&lt;2.0,&gt;=0.12 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.6-&gt;pytest-repeat) (0.13.1)
Requirement already satisfied: packaging in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.6-&gt;pytest-repeat) (21.0)
Requirement already satisfied: iniconfig in /home/khuyen/book/venv/lib/python3.8/site-packages (from pytest&gt;=3.6-&gt;pytest-repeat) (1.1.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pyparsing&gt;=2.0.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from packaging-&gt;pytest&gt;=3.6-&gt;pytest-repeat) (2.4.7)
</pre></div>
</div>
</div>
</div>
<p>It is a good practice to test your functions to make sure they work as expected, but sometimes you need to test 100 times until you found the rare cases when the test fails. That is when pytest-repeat comes in handy.</p>
<p>To understand how pytest-repeat works, start with putting the code below to the file named <code class="docutils literal notranslate"><span class="pre">pytest_repeat_example.py</span></code>. The <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.repeat(100)</span></code> decorator tells pytest to repeat the experiment 100 times.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_repeat_example.py</span>
<span class="kn">import</span> <span class="nn">pytest</span> 
<span class="kn">import</span> <span class="nn">random</span> 

<span class="k">def</span> <span class="nf">generate_numbers</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_generate_numbers</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">generate_numbers</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">generate_numbers</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">100</span>
</pre></div>
</div>
<p>On your terminal, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest pytest_repeat_example.py
</pre></div>
</div>
<p>We can see that 100 experiments are executed and passed:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pytest pytest_repeat_example.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-0.13.1
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter4
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0
<span class=" -Color -Color-Bold">collecting ... </span>
<span class=" -Color -Color-Bold">collected 100 items                                                            </span>

pytest_repeat_example.py 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">.......</span><span class=" -Color -Color-Red">F</span><span class=" -Color -Color-Green">.......................................</span><span class=" -Color -Color-Red"> [ 47%]</span>
<span class=" -Color -Color-Green">........</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">.................</span><span class=" -Color -Color-Red">F</span><span class=" -Color -Color-Green">......................</span><span class=" -Color -Color-Red">F</span><span class=" -Color -Color-Green">....</span><span class=" -Color -Color-Red">                    [100%]</span>

=================================== FAILURES ===================================
<span class=" -Color -Color-Bold -Color-Bold-Red">_________________________ test_generate_numbers[8-100] _________________________</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    <span class=" -Color -Color-White">@pytest</span>.mark.repeat(100)
    def test_generate_numbers():
&gt;       assert generate_numbers() &gt; 1 and generate_numbers() &lt; 100
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert (1 &gt; 1)</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E        +  where 1 = generate_numbers()</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">pytest_repeat_example.py</span>:9: AssertionError
<span class=" -Color -Color-Bold -Color-Bold-Red">________________________ test_generate_numbers[73-100] _________________________</span>

    <span class=" -Color -Color-White">@pytest</span>.mark.repeat(100)
    def test_generate_numbers():
&gt;       assert generate_numbers() &gt; 1 and generate_numbers() &lt; 100
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert (40 &gt; 1 and 100 &lt; 100)</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E        +  where 40 = generate_numbers()</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E        +  and   100 = generate_numbers()</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">pytest_repeat_example.py</span>:9: AssertionError
<span class=" -Color -Color-Bold -Color-Bold-Red">________________________ test_generate_numbers[96-100] _________________________</span>

    <span class=" -Color -Color-White">@pytest</span>.mark.repeat(100)
    def test_generate_numbers():
&gt;       assert generate_numbers() &gt; 1 and generate_numbers() &lt; 100
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert (43 &gt; 1 and 100 &lt; 100)</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E        +  where 43 = generate_numbers()</span>
<span class=" -Color -Color-Bold -Color-Bold-Red">E        +  and   100 = generate_numbers()</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">pytest_repeat_example.py</span>:9: AssertionError
=========================== short test summary info ============================
FAILED pytest_repeat_example.py::test_generate_numbers[8-100] - assert (1 &gt; 1)
FAILED pytest_repeat_example.py::test_generate_numbers[73-100] - assert (40 &gt;...
FAILED pytest_repeat_example.py::test_generate_numbers[96-100] - assert (43 &gt;...
<span class=" -Color -Color-Red">========================= </span><span class=" -Color -Color-Bold -Color-Bold-Red">3 failed</span>, <span class=" -Color -Color-Green">97 passed</span><span class=" -Color -Color-Red"> in 0.14s =========================</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/pytest-dev/pytest-repeat">Link to pytest-repeat</a></p>
</div>
<div class="section" id="pandera-a-python-library-to-validate-your-pandas-dataframe">
<h2>Pandera: a Python Library to Validate Your Pandas DataFrame<a class="headerlink" href="#pandera-a-python-library-to-validate-your-pandas-dataframe" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pandera
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pandera in /home/khuyen/book/venv/lib/python3.8/site-packages (0.7.0)
Requirement already satisfied: frictionless in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandera) (4.16.6)
Requirement already satisfied: packaging&gt;=20.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandera) (21.0)
Requirement already satisfied: numpy&gt;=1.9.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandera) (1.19.5)
Requirement already satisfied: typing-inspect&gt;=0.6.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandera) (0.7.1)
Requirement already satisfied: wrapt in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandera) (1.12.1)
Requirement already satisfied: pyarrow in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandera) (5.0.0)
Requirement already satisfied: pandas&gt;=1.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandera) (1.3.2)
Requirement already satisfied: pyparsing&gt;=2.0.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from packaging&gt;=20.0-&gt;pandera) (2.4.7)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytz&gt;=2017.3 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandas&gt;=1.0-&gt;pandera) (2021.1)
Requirement already satisfied: python-dateutil&gt;=2.7.3 in /home/khuyen/book/venv/lib/python3.8/site-packages (from pandas&gt;=1.0-&gt;pandera) (2.8.2)
Requirement already satisfied: six&gt;=1.5 in /home/khuyen/book/venv/lib/python3.8/site-packages (from python-dateutil&gt;=2.7.3-&gt;pandas&gt;=1.0-&gt;pandera) (1.16.0)
Requirement already satisfied: typing-extensions&gt;=3.7.4 in /home/khuyen/book/venv/lib/python3.8/site-packages (from typing-inspect&gt;=0.6.0-&gt;pandera) (3.10.0.2)
Requirement already satisfied: mypy-extensions&gt;=0.3.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from typing-inspect&gt;=0.6.0-&gt;pandera) (0.4.3)
Requirement already satisfied: jsonschema&gt;=2.5 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (3.2.0)
Requirement already satisfied: pyyaml&gt;=5.3 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (5.4.1)
Requirement already satisfied: requests&gt;=2.10 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (2.24.0)
Requirement already satisfied: simpleeval&gt;=0.9 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (0.9.10)
Requirement already satisfied: petl&gt;=1.6 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (1.7.4)
Requirement already satisfied: chardet&gt;=3.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (3.0.4)
Requirement already satisfied: stringcase&gt;=1.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (1.2.0)
Requirement already satisfied: typer[all]&gt;=0.4 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (0.4.0)
Requirement already satisfied: rfc3986&gt;=1.4 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (1.5.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: validators&gt;=0.18 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (0.18.2)
Requirement already satisfied: python-slugify&gt;=1.2 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (4.0.1)
Requirement already satisfied: isodate&gt;=0.6 in /home/khuyen/book/venv/lib/python3.8/site-packages (from frictionless-&gt;pandera) (0.6.0)
Requirement already satisfied: attrs&gt;=17.4.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from jsonschema&gt;=2.5-&gt;frictionless-&gt;pandera) (21.2.0)
Requirement already satisfied: setuptools in /home/khuyen/book/venv/lib/python3.8/site-packages (from jsonschema&gt;=2.5-&gt;frictionless-&gt;pandera) (44.0.0)
Requirement already satisfied: pyrsistent&gt;=0.14.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from jsonschema&gt;=2.5-&gt;frictionless-&gt;pandera) (0.18.0)
Requirement already satisfied: text-unidecode&gt;=1.3 in /home/khuyen/book/venv/lib/python3.8/site-packages (from python-slugify&gt;=1.2-&gt;frictionless-&gt;pandera) (1.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/khuyen/book/venv/lib/python3.8/site-packages (from requests&gt;=2.10-&gt;frictionless-&gt;pandera) (2021.5.30)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: idna&lt;3,&gt;=2.5 in /home/khuyen/book/venv/lib/python3.8/site-packages (from requests&gt;=2.10-&gt;frictionless-&gt;pandera) (2.10)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /home/khuyen/book/venv/lib/python3.8/site-packages (from requests&gt;=2.10-&gt;frictionless-&gt;pandera) (1.25.11)
Requirement already satisfied: click&lt;9.0.0,&gt;=7.1.1 in /home/khuyen/book/venv/lib/python3.8/site-packages (from typer[all]&gt;=0.4-&gt;frictionless-&gt;pandera) (7.1.2)
Requirement already satisfied: shellingham&lt;2.0.0,&gt;=1.3.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from typer[all]&gt;=0.4-&gt;frictionless-&gt;pandera) (1.4.0)
Requirement already satisfied: colorama&lt;0.5.0,&gt;=0.4.3 in /home/khuyen/book/venv/lib/python3.8/site-packages (from typer[all]&gt;=0.4-&gt;frictionless-&gt;pandera) (0.4.4)
Requirement already satisfied: decorator&gt;=3.4.0 in /home/khuyen/book/venv/lib/python3.8/site-packages (from validators&gt;=0.18-&gt;frictionless-&gt;pandera) (5.0.9)
</pre></div>
</div>
</div>
</div>
<p>The outputs of your pandas DataFrame might not be like what you expected either due to the error in your code or the change in the data format. Using data that is different from what you expected can cause errors or lead to decrease performance.</p>
<p>Thus, it is important to validate your data before using it. A good tool to validate pandas DataFrame is pandera. Pandera is easy to read and use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandera</span> <span class="k">as</span> <span class="nn">pa</span>
<span class="kn">from</span> <span class="nn">pandera</span> <span class="kn">import</span> <span class="n">check_input</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="s2">&quot;col2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text_1&quot;</span><span class="p">,</span> <span class="s2">&quot;text_2&quot;</span><span class="p">,</span> <span class="s2">&quot;text_3&quot;</span><span class="p">]})</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrameSchema</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="k">lambda</span> <span class="n">minute</span><span class="p">:</span> <span class="mi">5</span> <span class="o">&lt;=</span> <span class="n">minute</span><span class="p">)),</span>
        <span class="s2">&quot;col2&quot;</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">Check</span><span class="o">.</span><span class="n">str_startswith</span><span class="p">(</span><span class="s2">&quot;text_&quot;</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">validated_df</span> <span class="o">=</span> <span class="n">schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">validated_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.0</td>
      <td>text_1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.0</td>
      <td>text_2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.0</td>
      <td>text_3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can also use the pandera’s decorator check_inputto validates input pandas DataFrame before entering the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_input</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">plus_three</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;col1_plus_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="n">plus_three</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
      <th>col1_plus_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.0</td>
      <td>text_1</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.0</td>
      <td>text_2</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.0</td>
      <td>text_3</td>
      <td>13.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a class="reference external" href="https://pandera.readthedocs.io/en/stable/">Link to Pandera</a></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Chapter4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="better_pandas.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Better Pandas</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../Chapter5/Chapter5.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Cool Tools</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Khuyen Tran<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>